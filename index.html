
<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
    body {
      margin: 30px;
      font-family: Arial, sans-serif;
    }
    /* Flex layout for side-by-side charts */
    .chart-row {
      display: flex;
      gap: 20px; /* space between charts */
      align-items: flex-start;
    }
    /* Each chart container */
    .chart-box p {
  text-align: left;
  font-size: 14px;
  margin-top: 8px;
  color: #333;
}

    /* Add a vertical line separator on right side except last one */
    .chart-box:not(:last-child) {
      border-right: 3px solid #ccc;
    }
  </style>
</head>

<body>
  <h2>Traffic Accident Visualizations</h2>

  <div class="chart-row">
		<div class="chart-box">
		    <div id="chart1"></div>
			<br><br>
			<br><br>

			<h4>Description for Task1:</h4>

			<p>
				The following bar chart displays the number of accidents across the days of the week. The days of the week have been extracted from the field of acci_time using timeFormat and turned into a new field representing just the days of the week. The number of accidents have been counted by getting the sum of the accident IDs using aggregate function. It was then joined to find the maximum and minimum number of accidents using min, max functions. Then another field was calculated so as to label the bars which ones are minimum and maximum. 

				The graph as been encoded with the mark being the bars, the x-axis representing the days of the week that had been extracted and sorted from Monday to Sunday, then the y-axis or length representing the number of accidents for each day of the week.  

				The colors had been given to distinguish each unique day from the other.
			</p>
			
			<p>
			For interactivity, tooltip had been used so as to display the day of the week, number of accidents, and the status of whether it is min or max bar.
			A checkbox had also been added so as to show only the maximum and minimum bars of the entire chart. Once clicked all other bars get their opacity reduced to 0.2 while only the maximum and minimum bars have their full opacity with a value of 1. Once hovered over, it is shown whether the bar is a max or min bar. After checking the box, it is shown that the day Tuesday has the maximum number of accidents (7414 accidents) and the day Sunday has the minimum number of accidents (5545 accidents).
			</p>
			
			<p>
				Vega-lite reduces the data amount to leave a space for writing the code (declaring through JSON syntax) and not get overwhelmed since it's a website, so it automatically aggregates (grouping or summarizing) the data. On the other hand, Tableau is a standalone app that dosen't need to limit or simplify the data considering it's direct drag-and-drop interface working with the full dataset.
			</p>
	</div>
	
	
    <div class="chart-box">
		<div id="chart2"></div>
		<br><br>

		<h4>Description for Task2:</h4>

		<p>
		This combined line chart showcases the total number of accidents that occur at each hour of the day for each day throughout the week.  It displays the total number of accidents that occurred at each particular hour of the day using both line and point markers. The y-axis represents the overall number of accidents, while the x-axis indicates the hours (from 0 to 23, using the 24-hour system). Different colors are used to distinguish between each line, which represents a different day of the week.</p>
		<p>
		The visualization shows a general trend: the number of accidents stays relatively low from 12 AM to around 6 AM, then rises dramatically between 7 AM and 5 PM before progressively declining once again from 6 PM to 11 PM. Among the days, Thursday and Tuesday have the biggest peaks, with totals ranging from 400 to 500 accidents, while Sunday has fewer incidents than other days of the week.

		Additionally, the visualization has an interactive feature that shows the precise number of accidents when the user hovers over that exact point.</p>
	</div>
	
    <div class="chart-box">
	    <div id="chart3"></div>
		<h4>Description for Task3:</h4>
		
		<p>
		This graduated symbol map visualizes the density of traffic accidents across Dubai. The accident data was filtered to include only the longitudes and latitudes of accidents within Dubai's boundaries. The latitude and longitude values were rounded and grouped to combine nearby accidents (those occurring within roughly 300 meters of each other). This process was used to combine close accident points and reduce visual clutter. The total number of accidents at each location was then calculated using the count aggregation. Circles were plotted at these coordinates, with their color intensity representing accident density, where darker shades indicate higher accident densities, while lighter shades indicate lower densities.
		</p>
		
		<p>
		The latitude and longitude values were rounded and grouped to aggregate nearby accidents (accidents occurring within approximately 300 meters of each other). This process was used to combine close accident points and avoid visual clutter, allowing the map to clearly highlight the density. The total number of accidents was then calculated using the count aggregation. The color channel was used to encode the accident density, where darker shades represent a higher number of accidents, and lighter shades indicate lower frequencies.
		</p>
</div>
  </div>
  
  


  <script>
    // === Chart 1: Bar Chart ===
    const chart1 = {
      "data": {
        "url": "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv",
        "format": {"type": "csv", "parse": {"acci_time": "date:'%d/%m/%Y %H:%M:%S'"}}
      },
      "width": 400,
      "height": 400,
	  "transform":[{
    "calculate":"timeFormat(datum.acci_time, '%a')","as":"daysOfTheWeek"
  },
  {"aggregate":[{"op":"count", "as":"accidentsCount","field":"acci_id"}],"groupby":["daysOfTheWeek"]},
  {
    "joinaggregate":[{
      "op":"max", "field":"accidentsCount","as":"maxCount"
    }, {
      "op":"min", "field":"accidentsCount","as":"minCount"
    }]
  },{
    "calculate":"datum.accidentsCount==datum.maxCount?'max': (datum.accidentsCount==datum.minCount?'min':'other')",
    "as":"highlightStatus"
  }
  ],
  "params":[
    {
      "name":"highlightMinMax",
      "value":false, "bind":{
        "input":"checkbox","name":"Show Maximum and Minimum Number of Accidents"
      }
    }
  ],
      "title": "Total Number of Accidents Across Days of the Week",
      "mark": {"type": "bar", "width": {"band": 0.6}},
        "encoding": {
        "x": {
          
          "field": "daysOfTheWeek",
          "type": "nominal",
          "sort": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
          "title": "Day of the Week "
        },
        "y": {
          
          "field": "accidentsCount",
          "type": "quantitative",
          "title": "Number of Accidents"
        },
        "color": {
         
          "field": "daysOfTheWeek",
          "type": "nominal",
          "title": "Days of the Week "
        },
        "opacity":{
          "value":1,
          
          "condition":[
            
            {
              "test":"highlightMinMax && (datum.highlightStatus!='max' && datum.highlightStatus!='min')",
              "value":0.2
            }
          ]
        },

        "tooltip": [
          {
            
            "field": "daysOfTheWeek",
            "type": "nominal",
            "sort": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            "title": "Day of the Week "
          },
          {
            
            "field": "accidentsCount",
            "type": "quantitative",
            "title": "Number of Accidents"
          },
          {
            "field":"highlightStatus", "type":"nominal","title":"Status"
          }
        ]
  
  
  }};
    // === Chart 2: Line Chart ===
    const chart2 = {
      "data": {
        "url": "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv",
        "format": {"type": "csv", "parse": {"acci_time": "date:'%d/%m/%Y %H:%M:%S'"}}
      },
      "transform": [
        {"calculate": "hours(datum.acci_time)", "as": "hour"},
        {"calculate": "timeFormat(datum.acci_time, '%A')", "as": "day_of_the_week"}
      ],
      "width": 700,
      "height": 500,
      "title": "Traffic Accidents by the Time of Day and Weekdays",
      "mark": {"type": "line", "point": {"filled": true, "size": 70}},
      "encoding": {
        "x": {
          "field": "hour",
          "type": "ordinal",
          "title": "Hour of the Day (0-23)",
          "axis": {"values": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10,
              11,
              12,
              13,
              14,
              15,
              16,
              17,
              18,
              19,
              20,
              21,
              22,
              23
            ],"labelAngle": 0}
        },
        "y": {"aggregate": "count", "type": "quantitative", "title": "Number of Accidents"},
        "color": {
          "field": "day_of_the_week",
          "type": "nominal",
          "title": "Days of the Week",
          "sort": ["Monday",
					"Tuesday",
					"Wednesday",
					"Thursday",
					"Friday",
					"Saturday",
					"Sunday"]
        },
        "tooltip": [
          {"field": "hour", "type": "quantitative", "title": "Hour"},
          {"field": "day_of_the_week", "type": "nominal", "title": "Day"},
          {"aggregate": "count", "type": "quantitative", "title": "Accidents"}
        ]
      }
    };

    // === Chart 3: Dubai Accident Map ===
    const chart3 = {
      "data": {
        "url": "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv",
        "format": {"type": "csv", "parse": {"acci_time": "date:'%d/%m/%Y %H:%M:%S'"}}
      },
      "title": "Accident Density Map Across Dubai",
      "width": 1000,
	  "height": 600,
	"autosize": {"type": "fit", "contains": "padding"},

      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/janab957/dubai-geojson/refs/heads/main/Dubai.geojson",
            "format": {"type": "json"}
          },
          "mark": {"type": "geoshape", "fill": "#f4f4f4", "stroke": "#e4e4e4"}
        },
        {
          "transform": [
            {"filter": "datum.acci_y > 23"},
            {"calculate": "round(datum.acci_x * 300) / 300", "as": "lat"},
            {"calculate": "round(datum.acci_y * 300) / 300", "as": "lon"},
            {"aggregate": [{"op": "count", "as": "total"}], "groupby": ["lat", "lon"]}
          ],
          "mark": {"type": "circle", "opacity": 0.4},
          "encoding": {
            "latitude": {"field": "lat", "type": "quantitative"},
            "longitude": {"field": "lon", "type": "quantitative"},
            "size": {"value": 20},
            "color": {
              "field": "total",
              "type": "quantitative",
              "title": "Accident Density",
              "scale": {
                "type": "sqrt",
                "range": ["#ffdb99",
						"#ff6600",
						"#cc0000",
						"#660000",
						"#0d0000"]
              }
            },
            "tooltip": [
              {"field": "lat", "title": "Lat"},
              {"field": "lon", "title": "Lon"},
              {"field": "total", "title": "Accidents"}
            ]
          }
        }
      ]
    };

    // Embed all three charts
    vegaEmbed("#chart1", chart1);
    vegaEmbed("#chart2", chart2);
    vegaEmbed("#chart3", chart3);
  </script>
</body>
</html>





